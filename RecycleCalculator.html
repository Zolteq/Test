<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="RecycleCSS.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body>
  <button id="dark-mode-btn" onclick="toggleDarkMode()">
    <div class="switch">
        <i class="fas fa-sun"></i>
        <i class="fas fa-moon"></i>
    </div>
  </button>
  <div class="header">
    <img src="icon/Recycler_icon.png" alt="Fertilizer Icon" width="48" height="48">
    <h1>Recycle Calculator</h1>
  </div>
  <button class="back-button" onclick="goBack()">Back</button>
  <div class="container">
    <div class="component-section"> <!-- Added this wrapper -->
      <button class="add-component-button small-width" onclick="toggleComponentList()">Add Specific Components & Items</button>
      <div id="component-list" class="dropdown-content">
          <input type="text" id="component-search" placeholder="Search..." onclick="stopPropagation(event)" oninput="filterComponents()">
          <div class="component-option" onclick="addComponent('Auto Turret')">
            <div class="icon-container">
              <img src="./icon/autoturret.png" alt="Auto Turret">
            </div>
            <span>Auto Turret</span>
          </div>
          <div class="component-option">
            <div class="icon-container">
              <img src="./icon/m249.png" alt="M249">
            </div>
            <span>M249</span>
          </div>
      </div>
      <div class="component-grid">
      <div class="component">
        <img src="./icon/sheetmetal.png" alt="Sheet Metal">
        <span class="component-name">Sheet Metal</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/rope.png" alt="Rope">
        <span class="component-name">Rope</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/tarp.png" alt="Tarp">
        <span class="component-name">Tarp</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/sewingkit.png" alt="Sewing Kit">
        <span class="component-name">Sewing Kit</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/roadsigns.png" alt="Road Signs">
        <span class="component-name">Road Signs</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/metalspring.png" alt="Metal Spring">
        <span class="component-name">Metal Spring</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/semibody.png" alt="Semi Automatic Body">
        <span class="component-name">Semi Automatic Body</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/riflebody.png" alt="Rifle Body">
        <span class="component-name">Rifle Body</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/metalpipe.png" alt="Metal Pipe">
        <span class="component-name">Metal Pipe</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/gears.png" alt="Gears">
        <span class="component-name">Gears</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/propanetank.png" alt="Empty Propane Tank">
        <span class="component-name">Empty Propane Tank</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/techparts.png" alt="Tech Trash">
        <span class="component-name">Tech Trash</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/smgbody.png" alt="SMG Body">
        <span class="component-name">SMG Body</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/Blade.png" alt="Metal Blade">
        <span class="component-name">Metal Blade</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/cctvcamera.png" alt="CCTV Camera">
        <span class="component-name">CCTV Camera</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      <div class="component">
        <img src="./icon/targetingcomputer.png" alt="Targeting Computer">
        <span class="component-name">Targeting Computer</span>
        <input type="number" value="" min="0" placeholder="0" onchange="calculateResult()">
      </div>
      </div>
    </div>
    <div class="resources-section">
     <div class="resources-label">
        <h2>Resources</h2>
      </div>
      <div id="result-container"></div>
    </div>
    <div class="scrap-options">
      <input type="radio" id="scrap-all" name="scrap-option" value="all" checked>
      <label for="scrap-all">Scrap Sub Components</label>
      <input type="radio" id="scrap-once" name="scrap-option" value="once">
      <label for="scrap-once">Keep Sub Components</label>
    </div>
  </div>  
</div>
  <script>
// Function to go back to the previous page
function goBack() {
  history.back(); // Navigate back to the previous page
}
  
// Function to toggle the component list dropdown
function toggleComponentList() {
  const componentList = document.getElementById('component-list');
  componentList.classList.toggle('show');
}

// Function to stop event propagation
function stopPropagation(event) {
  event.stopPropagation();
}

// Function to filter the components based on the search input
function filterComponents() {
  const searchInput = document.getElementById('component-search');
  const filterValue = searchInput.value.toLowerCase();
  const componentOptions = document.querySelectorAll('.component-option');

  componentOptions.forEach(option => {
    const componentText = option.textContent.toLowerCase();
    const shouldDisplay = componentText.includes(filterValue);
    option.style.display = shouldDisplay ? 'flex' : 'none';
  });
}

function addComponent(componentName) {
  const componentList = document.querySelector('.component-grid');
  
  // Create the new component element
  const component = document.createElement('div');
  component.classList.add('component');
  
  // Create the image element
  const image = document.createElement('img');
  image.src = `./icon/${componentName.toLowerCase().replace(/ /g, '')}.png`;
  image.alt = componentName;
  component.appendChild(image);
  
  // Create the component name element
  const componentNameSpan = document.createElement('span');
  componentNameSpan.classList.add('component-name');
  componentNameSpan.textContent = componentName;
  component.appendChild(componentNameSpan);
  
  // Create the input element
  const input = document.createElement('input');
  input.type = 'number';
  input.value = '';
  input.min = '0';
  input.placeholder = '0';
  input.onchange = calculateResult;
  component.appendChild(input);
  
  // Append the new component to the component list
  componentList.appendChild(component);
  
  // Calculate the height for component grid
  // You may adjust the '100' based on the actual height of your components and the gap between rows.
  const rows = Math.ceil(componentList.childElementCount / 8);
  componentList.style.height = `${rows * 135}px`; 

  toggleComponentList();
}

// Close the component list dropdown when clicking outside of it
window.onclick = function(event) {
  if (!event.target.matches('.add-component-button')) {
    const componentList = document.getElementById('component-list');
    if (componentList.classList.contains('show')) {
      componentList.classList.remove('show');
    }
  }
};

        const darkModeKey = 'darkMode';

// Function to toggle dark mode
function toggleDarkMode() {
    const body = document.body;
    const switchButton = document.querySelector('.switch');

    // Toggle dark mode class on body
    body.classList.toggle('dark-mode');
    // Toggle switch-on class on switch button
    switchButton.classList.toggle('switch-on');

    // Check if dark mode is active
    const isDarkMode = body.classList.contains('dark-mode');

    // Toggle the icons based on dark mode state
    const moonIcon = switchButton.querySelector('.fa-moon');
    const sunIcon = switchButton.querySelector('.fa-sun');

    if (isDarkMode) {
        moonIcon.style.display = 'block';
        sunIcon.style.display = 'none';
    } else {
        moonIcon.style.display = 'none';
        sunIcon.style.display = 'block';
    }

    // Save user's preference to localStorage
    localStorage.setItem(darkModeKey, isDarkMode);
}

// Function to apply the appropriate icon based on dark mode preference
function applyDarkModePreference() {
    const body = document.body;
    const switchButton = document.querySelector('.switch');
    const moonIcon = switchButton.querySelector('.fa-moon');
    const sunIcon = switchButton.querySelector('.fa-sun');

    const savedDarkMode = localStorage.getItem(darkModeKey);

    if (savedDarkMode === 'true') {
        body.classList.add('dark-mode');
        switchButton.classList.add('switch-on');
        moonIcon.style.display = 'block';
        sunIcon.style.display = 'none';
    } else {
        body.classList.remove('dark-mode');
        switchButton.classList.remove('switch-on');
        moonIcon.style.display = 'none';
        sunIcon.style.display = 'block';
    }
}

// Check if user has a saved preference
applyDarkModePreference();

    // Define the resource icons
    const resourceIcons = {
      'Scrap': './icon/scrap.png',
      'Metal Fragments': './icon/metalfragments.png',
      'High Quality Metal': './icon/highqualitymetal.png',
      'Rope': './icon/rope.png',
      'Tarp': './icon/tarp.png',
      'Cloth': './icon/cloth.png',
      'Road Signs': './icon/roadsigns.png',
      'Metal Spring': './icon/metalspring.png',
      'Semi Automatic Body': './icon/semibody.png',
      'Rifle Body': './icon/riflebody.png',
      'Metal Pipe': './icon/metalpipe.png',
      'Gears': './icon/gears.png',
      'Empty Propane Tank': './icon/propanetank.png',
      'Tech Trash': './icon/techparts.png',
      'SMG Body': './icon/smgbody.png',
      'Metal Blade': './icon/Blade.png',
      'CCTV Camera': './icon/cctvcamera.png',
      'Targeting Computer': './icon/targetingcomputer',
      'Auto Turret': './icon/autoturret.png'
    };

    // Define the resource mappings
    const resourceMappings = {
      'Sheet Metal': [
        { name: 'Scrap', amount: 8 },
        { name: 'Metal Fragments', amount: 100 },
        { name: 'High Quality Metal', amount: 1 },
      ],
      'Rope': [
        { name: 'Cloth', amount: 15 },
      ],
      'Tarp': [
        { name: 'Tarp', amount: 1 },
      ],
      'Sewing Kit': [
        { name: 'Cloth', amount: 10 },
        { name: 'Rope', amount: 2 },
      ],
      'Road Signs': [
        { name: 'Scrap', amount: 5 },
        { name: 'High Quality Metal', amount: 1 },
      ],
      'Metal Spring': [
        { name: 'Scrap', amount: 10 },
        { name: 'High Quality Metal', amount: 1 },
      ],
      'Semi Automatic Body': [
        { name: 'Scrap', amount: 15 },
        { name: 'High Quality Metal', amount: 2 },
        { name: 'Metal Fragments', amount: 75 },
      ],
      'Rifle Body': [
        { name: 'Scrap', amount: 25 },
        { name: 'High Quality Metal', amount: 2 },
      ],
      'Metal Pipe': [
        { name: 'Scrap', amount: 5 },
        { name: 'High Quality Metal', amount: 1 },
      ],
      'Gears': [
        { name: 'Scrap', amount: 10 },
        { name: 'Metal Fragments', amount: 13 },
      ],
      'Empty Propane Tank': [
        { name: 'Scrap', amount: 1 },
        { name: 'Metal Fragments', amount: 50 },
      ],
      'Tech Trash': [
        { name: 'Scrap', amount: 20 },
        { name: 'High Quality Metal', amount: 1 },
      ],
      'SMG Body': [
        { name: 'Scrap', amount: 15 },
        { name: 'High Quality Metal', amount: 2 },
      ],
      'Metal Blade': [
        { name: 'Scrap', amount: 2 },
        { name: 'Metal Fragments', amount: 15 },
      ],
      'CCTV Camera': [
        { name: 'Tech Trash', amount: 2 },
        { name: 'High Quality Metal', amount: 2 },
      ],
      'Targeting Computer': [
        { name: 'Tech Trash', amount: 3 },
        { name: 'High Quality Metal', amount: 1},
        { name: 'Metal Fragments', amount: 50 },
      ],
      'Auto Turret': [
        { name: 'Targeting Computer', amount: '50%' },
        { name: 'CCTV Camera', amount: '50%' },
      ]
    };


// Function to get the icon for a resource
function getIcon(resourceName) {
  // split the resource name into words
  const words = resourceName.split(' ');

  // If there is a percentage, the actual name starts from the second word
  if (words[0].endsWith('%')) {
    // Remove the percentage part
    words.shift();
  }

  // Join the remaining words to form the actual name
  const name = words.join(' ');

  // Check if resourceIcons has this name as a key
  if (resourceIcons.hasOwnProperty(name)) {
    return resourceIcons[name];
  } else {
    // If the name isn't found in resourceIcons, return a default or error image
    return "path/to/default/image.png";
  }
}

  // Function to calculate and display the result
  function calculateResult() {
    const components = document.querySelectorAll('.component');
    const scrapAllOption = document.getElementById('scrap-all').checked;

    // Clear the previous result
    const resultContainer = document.getElementById('result-container');
    resultContainer.innerHTML = '';

    // Calculate the total resources
    const totalResources = {};

    // Iterate over the components
    components.forEach(component => {
      const componentName = component.querySelector('.component-name').textContent;
      const quantityInput = component.querySelector('input');
      const quantity = parseInt(quantityInput.value);

      // Calculate the resources for the component
      calculateResources(componentName, quantity);
    });

    function calculateResources(componentName, quantity, processedComponents = new Set()) {
  if (!processedComponents.has(componentName) && resourceMappings.hasOwnProperty(componentName)) {
    processedComponents.add(componentName);
    const resources = resourceMappings[componentName];

    resources.forEach(resource => {
      const { name, amount } = resource;

      if (typeof amount === "string" && amount.endsWith("%")) {
        // Create a string resource in totalResources
        const percentageResource = `${amount} ${name}`;
        if (!totalResources.hasOwnProperty(percentageResource)) {
          totalResources[percentageResource] = quantity;
        } else {
          totalResources[percentageResource] += quantity;
        }
      } else {
        const totalAmount = quantity * amount;

        if (totalAmount > 0) {
          if (totalResources.hasOwnProperty(name)) {
            totalResources[name] += totalAmount;
          } else {
            totalResources[name] = totalAmount;
          }

          // Check if the resource is another component and if "Scrap All" option is selected
          if (resourceMappings.hasOwnProperty(name) && scrapAllOption) {
            calculateResources(name, totalAmount, processedComponents);
          }
        }
      }
    });
  }
}

    // Display the total resources
    Object.entries(totalResources).forEach(([name, amount]) => {
      // If the resource is a component and it's fully scrapped, skip it
      if (resourceMappings.hasOwnProperty(name) && scrapAllOption) return;

      const resourceItem = document.createElement('div');
      resourceItem.classList.add('resource-item');

      // Create the icon element
      const icon = document.createElement('img');
      icon.src = getIcon(name);
      icon.alt = name;
      resourceItem.appendChild(icon);
      
      

      // Create the resource name element
      const resourceName = document.createElement('span');
      resourceName.innerHTML = `${name}:&nbsp; `;
      resourceItem.appendChild(resourceName);

      // Create the amount element
      const resourceAmount = document.createElement('span');
      resourceAmount.classList.add('resource-amount');
      resourceAmount.textContent = amount;
      resourceItem.appendChild(resourceAmount);

      resultContainer.appendChild(resourceItem);
    });
  }

  const componentGrid = document.querySelector('.component-grid');
  componentGrid.addEventListener('input', calculateResult);

  // Event listeners for radio buttons
  const scrapAllOption = document.getElementById('scrap-all');
  const scrapOnceOption = document.getElementById('scrap-once');

  scrapAllOption.addEventListener('change', calculateResult);
  scrapOnceOption.addEventListener('change', calculateResult);

          // Function to check if dark mode is active
          function isDarkMode() {
            return document.body.classList.contains('dark-mode');
        }
</script>

</script>
</body>
</html>
